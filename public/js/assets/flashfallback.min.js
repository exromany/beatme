/*!
 * Socky JavaScript Library
 *
 * @version 0.5.0
 * @author  Bernard Potocki <bernard.potocki@imanel.org>
 * @author  Stefano Verna <stefano.verna@welaika.com>
 * @licence The MIT licence.
 * @source  http://github.com/socky/socky-client-js
 */
/*!
 * This library contains code with the following licences:
 *
 * web_socket.js:
 *
 *   Copyright: Hiroshi Ichikawa <http://gimite.net/en/>
 *   License: New BSD License
 *   Reference: http://dev.w3.org/html5/websockets/
 *   Reference: http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol
 *
 * swfobject.js:
 *
 *   SWFObject v2.2 <http://code.google.com/p/swfobject/>
 *   is released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */

var swfobject=function(){function i(){if(!w){try{var b=e.getElementsByTagName("body")[0].appendChild(e.createElement("span"));b.parentNode.removeChild(b)}catch(c){return}w=!0;b=C.length;for(var j=0;j<b;j++)C[j]()}}function a(b){w?b():C[C.length]=b}function d(b){if(typeof o.addEventListener!=k)o.addEventListener("load",b,!1);else if(typeof e.addEventListener!=k)e.addEventListener("load",b,!1);else if(typeof o.attachEvent!=k)U(o,"onload",b);else if(typeof o.onload=="function"){var c=o.onload;o.onload=
function(){c();b()}}else o.onload=b}function y(){var b=e.getElementsByTagName("body")[0],c=e.createElement(s);c.setAttribute("type",D);var j=b.appendChild(c);if(j){var a=0;(function(){if(typeof j.GetVariable!=k){var g=j.GetVariable("$version");if(g)g=g.split(" ")[1].split(","),f.pv=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}else if(a<10){a++;setTimeout(arguments.callee,10);return}b.removeChild(c);j=null;p()})()}else p()}function p(){var b=u.length;if(b>0)for(var c=0;c<b;c++){var j=u[c].id,
a=u[c].callbackFn,g={success:!1,id:j};if(f.pv[0]>0){var e=q(j);if(e)if(E(u[c].swfVersion)&&!(f.wk&&f.wk<312)){if(x(j,!0),a)g.success=!0,g.ref=A(j),a(g)}else if(u[c].expressInstall&&r()){g={};g.data=u[c].expressInstall;g.width=e.getAttribute("width")||"0";g.height=e.getAttribute("height")||"0";if(e.getAttribute("class"))g.styleclass=e.getAttribute("class");if(e.getAttribute("align"))g.align=e.getAttribute("align");var h={};e=e.getElementsByTagName("param");for(var d=e.length,m=0;m<d;m++)e[m].getAttribute("name").toLowerCase()!=
"movie"&&(h[e[m].getAttribute("name")]=e[m].getAttribute("value"));I(g,h,j,a)}else V(e),a&&a(g)}else if(x(j,!0),a){if((j=A(j))&&typeof j.SetVariable!=k)g.success=!0,g.ref=j;a(g)}}}function A(b){var c=null;if((b=q(b))&&b.nodeName=="OBJECT")typeof b.SetVariable!=k?c=b:(b=b.getElementsByTagName(s)[0])&&(c=b);return c}function r(){return!F&&E("6.0.65")&&(f.win||f.mac)&&!(f.wk&&f.wk<312)}function I(b,c,a,l){F=!0;J=l||null;N={success:!1,id:a};var g=q(a);if(g){g.nodeName=="OBJECT"?(B=K(g),G=null):(B=g,G=
a);b.id=O;if(typeof b.width==k||!/%$/.test(b.width)&&parseInt(b.width,10)<310)b.width="310";if(typeof b.height==k||!/%$/.test(b.height)&&parseInt(b.height,10)<137)b.height="137";e.title=e.title.slice(0,47)+" - Flash Player Installation";l=f.ie&&f.win?"ActiveX":"PlugIn";l="MMredirectURL="+o.location.toString().replace(/&/g,"%26")+"&MMplayerType="+l+"&MMdoctitle="+e.title;typeof c.flashvars!=k?c.flashvars+="&"+l:c.flashvars=l;if(f.ie&&f.win&&g.readyState!=4)l=e.createElement("div"),a+="SWFObjectNew",
l.setAttribute("id",a),g.parentNode.insertBefore(l,g),g.style.display="none",function(){g.readyState==4?g.parentNode.removeChild(g):setTimeout(arguments.callee,10)}();L(b,c,a)}}function V(b){if(f.ie&&f.win&&b.readyState!=4){var c=e.createElement("div");b.parentNode.insertBefore(c,b);c.parentNode.replaceChild(K(b),c);b.style.display="none";(function(){b.readyState==4?b.parentNode.removeChild(b):setTimeout(arguments.callee,10)})()}else b.parentNode.replaceChild(K(b),b)}function K(b){var c=e.createElement("div");
if(f.win&&f.ie)c.innerHTML=b.innerHTML;else if(b=b.getElementsByTagName(s)[0])if(b=b.childNodes)for(var a=b.length,l=0;l<a;l++)!(b[l].nodeType==1&&b[l].nodeName=="PARAM")&&b[l].nodeType!=8&&c.appendChild(b[l].cloneNode(!0));return c}function L(b,c,a){var l,g=q(a);if(f.wk&&f.wk<312)return l;if(g){if(typeof b.id==k)b.id=a;if(f.ie&&f.win){var d="",h;for(h in b)if(b[h]!=Object.prototype[h])h.toLowerCase()=="data"?c.movie=b[h]:h.toLowerCase()=="styleclass"?d+=' class="'+b[h]+'"':h.toLowerCase()!="classid"&&
(d+=" "+h+'="'+b[h]+'"');h="";for(var n in c)c[n]!=Object.prototype[n]&&(h+='<param name="'+n+'" value="'+c[n]+'" />');g.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+d+">"+h+"</object>";H[H.length]=b.id;l=q(b.id)}else{n=e.createElement(s);n.setAttribute("type",D);for(var m in b)b[m]!=Object.prototype[m]&&(m.toLowerCase()=="styleclass"?n.setAttribute("class",b[m]):m.toLowerCase()!="classid"&&n.setAttribute(m,b[m]));for(d in c)c[d]!=Object.prototype[d]&&d.toLowerCase()!=
"movie"&&(b=n,h=d,m=c[d],a=e.createElement("param"),a.setAttribute("name",h),a.setAttribute("value",m),b.appendChild(a));g.parentNode.replaceChild(n,g);l=n}}return l}function P(b){var c=q(b);if(c&&c.nodeName=="OBJECT")f.ie&&f.win?(c.style.display="none",function(){if(c.readyState==4){var a=q(b);if(a){for(var e in a)typeof a[e]=="function"&&(a[e]=null);a.parentNode.removeChild(a)}}else setTimeout(arguments.callee,10)}()):c.parentNode.removeChild(c)}function q(b){var c=null;try{c=e.getElementById(b)}catch(a){}return c}
function U(b,c,a){b.attachEvent(c,a);z[z.length]=[b,c,a]}function E(b){var a=f.pv;b=b.split(".");b[0]=parseInt(b[0],10);b[1]=parseInt(b[1],10)||0;b[2]=parseInt(b[2],10)||0;return a[0]>b[0]||a[0]==b[0]&&a[1]>b[1]||a[0]==b[0]&&a[1]==b[1]&&a[2]>=b[2]?!0:!1}function Q(b,a,j,d){if(!f.ie||!f.mac){var g=e.getElementsByTagName("head")[0];if(g){j=j&&typeof j=="string"?j:"screen";d&&(M=t=null);if(!t||M!=j)d=e.createElement("style"),d.setAttribute("type","text/css"),d.setAttribute("media",j),t=g.appendChild(d),
f.ie&&f.win&&typeof e.styleSheets!=k&&e.styleSheets.length>0&&(t=e.styleSheets[e.styleSheets.length-1]),M=j;f.ie&&f.win?t&&typeof t.addRule==s&&t.addRule(b,a):t&&typeof e.createTextNode!=k&&t.appendChild(e.createTextNode(b+" {"+a+"}"))}}}function x(b,a){if(R){var e=a?"visible":"hidden";w&&q(b)?q(b).style.visibility=e:Q("#"+b,"visibility:"+e)}}function S(b){return/[\\\"<>\.;]/.exec(b)!=null&&typeof encodeURIComponent!=k?encodeURIComponent(b):b}var k="undefined",s="object",D="application/x-shockwave-flash",
O="SWFObjectExprInst",o=window,e=document,v=navigator,T=!1,C=[function(){T?y():p()}],u=[],H=[],z=[],B,G,J,N,w=!1,F=!1,t,M,R=!0,f=function(){var b=typeof e.getElementById!=k&&typeof e.getElementsByTagName!=k&&typeof e.createElement!=k,a=v.userAgent.toLowerCase(),j=v.platform.toLowerCase(),f=j?/win/.test(j):/win/.test(a);j=j?/mac/.test(j):/mac/.test(a);a=/webkit/.test(a)?parseFloat(a.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1;var g=!1,d=[0,0,0],h=null;if(typeof v.plugins!=k&&typeof v.plugins["Shockwave Flash"]==
s){if((h=v.plugins["Shockwave Flash"].description)&&!(typeof v.mimeTypes!=k&&v.mimeTypes[D]&&!v.mimeTypes[D].enabledPlugin))T=!0,g=!1,h=h.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),d[0]=parseInt(h.replace(/^(.*)\..*$/,"$1"),10),d[1]=parseInt(h.replace(/^.*\.(.*)\s.*$/,"$1"),10),d[2]=/[a-zA-Z]/.test(h)?parseInt(h.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}else if(typeof o.ActiveXObject!=k)try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(n&&(h=n.GetVariable("$version")))g=!0,h=h.split(" ")[1].split(","),
d=[parseInt(h[0],10),parseInt(h[1],10),parseInt(h[2],10)]}catch(m){}return{w3:b,pv:d,wk:a,ie:g,win:f,mac:j}}();(function(){f.w3&&((typeof e.readyState!=k&&e.readyState=="complete"||typeof e.readyState==k&&(e.getElementsByTagName("body")[0]||e.body))&&i(),w||(typeof e.addEventListener!=k&&e.addEventListener("DOMContentLoaded",i,!1),f.ie&&f.win&&(e.attachEvent("onreadystatechange",function(){e.readyState=="complete"&&(e.detachEvent("onreadystatechange",arguments.callee),i())}),o==top&&function(){if(!w){try{e.documentElement.doScroll("left")}catch(b){setTimeout(arguments.callee,
0);return}i()}}()),f.wk&&function(){w||(/loaded|complete/.test(e.readyState)?i():setTimeout(arguments.callee,0))}(),d(i)))})();(function(){f.ie&&f.win&&window.attachEvent("onunload",function(){for(var b=z.length,a=0;a<b;a++)z[a][0].detachEvent(z[a][1],z[a][2]);b=H.length;for(a=0;a<b;a++)P(H[a]);for(var e in f)f[e]=null;f=null;for(var d in swfobject)swfobject[d]=null;swfobject=null})})();return{registerObject:function(b,a,e,d){if(f.w3&&b&&a){var g={};g.id=b;g.swfVersion=a;g.expressInstall=e;g.callbackFn=
d;u[u.length]=g;x(b,!1)}else d&&d({success:!1,id:b})},getObjectById:function(a){if(f.w3)return A(a)},embedSWF:function(b,c,e,d,g,y,h,n,m,i){var o={success:!1,id:c};f.w3&&!(f.wk&&f.wk<312)&&b&&c&&e&&d&&g?(x(c,!1),a(function(){e+="";d+="";var a={};if(m&&typeof m===s)for(var f in m)a[f]=m[f];a.data=b;a.width=e;a.height=d;f={};if(n&&typeof n===s)for(var p in n)f[p]=n[p];if(h&&typeof h===s)for(var q in h)typeof f.flashvars!=k?f.flashvars+="&"+q+"="+h[q]:f.flashvars=q+"="+h[q];if(E(g))p=L(a,f,c),a.id==
c&&x(c,!0),o.success=!0,o.ref=p;else if(y&&r()){a.data=y;I(a,f,c,i);return}else x(c,!0);i&&i(o)})):i&&i(o)},switchOffAutoHideShow:function(){R=!1},ua:f,getFlashPlayerVersion:function(){return{major:f.pv[0],minor:f.pv[1],release:f.pv[2]}},hasFlashPlayerVersion:E,createSWF:function(a,c,e){if(f.w3)return L(a,c,e)},showExpressInstall:function(a,c,e,d){f.w3&&r()&&I(a,c,e,d)},removeSWF:function(a){f.w3&&P(a)},createCSS:function(a,c,e,d){f.w3&&Q(a,c,e,d)},addDomLoadEvent:a,addLoadEvent:d,getQueryParamValue:function(a){var c=
e.location.search||e.location.hash;if(c){/\?/.test(c)&&(c=c.split("?")[1]);if(a==null)return S(c);c=c.split("&");for(var d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return S(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(F){var a=q(O);if(a&&B){a.parentNode.replaceChild(B,a);if(G&&(x(G,!0),f.ie&&f.win))B.style.display="block";J&&J(N)}F=!1}}}}();
(function(){if(!window.WebSocket||window.WEB_SOCKET_FORCE_FLASH){var i;i=window.WEB_SOCKET_LOGGER?WEB_SOCKET_LOGGER:window.console&&window.console.log&&window.console.error?window.console:{log:function(){},error:function(){}};swfobject.getFlashPlayerVersion().major<10?i.error("Flash Player >= 10.0.0 is required."):(location.protocol=="file:"&&i.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),
WebSocket=function(a,d,i,p,A){var r=this;r.__id=WebSocket.__nextId++;WebSocket.__instances[r.__id]=r;r.readyState=WebSocket.CONNECTING;r.bufferedAmount=0;r.__events={};d?typeof d=="string"&&(d=[d]):d=[];setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(r.__id,a,d,i||null,p||0,A||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";a=WebSocket.__flash.send(this.__id,
encodeURIComponent(a));return a<0?!0:(this.bufferedAmount+=a,!1)},WebSocket.prototype.close=function(){if(!(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING))this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id)},WebSocket.prototype.addEventListener=function(a,d){a in this.__events||(this.__events[a]=[]);this.__events[a].push(d)},WebSocket.prototype.removeEventListener=function(a,d){if(a in this.__events)for(var i=this.__events[a],p=i.length-1;p>=0;--p)if(i[p]===
d){i.splice(p,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var d=this.__events[a.type]||[],i=0;i<d.length;++i)d[i](a);(d=this["on"+a.type])&&d(a)},WebSocket.prototype.__handleEvent=function(a){if("readyState"in a)this.readyState=a.readyState;if("protocol"in a)this.protocol=a.protocol;if(a.type=="open"||a.type=="error")a=this.__createSimpleEvent(a.type);else if(a.type=="close")a=this.__createSimpleEvent("close");else if(a.type=="message")a=this.__createMessageEvent("message",decodeURIComponent(a.message));
else throw"unknown event type: "+a.type;this.dispatchEvent(a)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&window.Event){var d=document.createEvent("Event");d.initEvent(a,!1,!1);return d}else return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,d){if(document.createEvent&&window.MessageEvent&&!window.opera){var i=document.createEvent("MessageEvent");i.initMessageEvent("message",!1,!1,d,null,null,window,null);return i}else return{type:a,
data:d,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},WebSocket.__initialize=function(){if(!WebSocket.__flash){if(WebSocket.__swfLocation)window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation;if(window.WEB_SOCKET_SWF_LOCATION){if(!window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&
!WEB_SOCKET_SWF_LOCATION.match(/(^|\/)WebSocketMainInsecure\.swf(\?.*)?$/)&&WEB_SOCKET_SWF_LOCATION.match(/^\w+:\/\/([^\/]+)/)){var a=RegExp.$1;location.host!=a&&i.error("[WebSocket] You must host HTML and WebSocketMain.swf in the same host ('"+location.host+"' != '"+a+"'). See also 'How to host HTML file and SWF file in different domains' section in README.md. If you use WebSocketMainInsecure.swf, you can suppress this message by WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR = true;")}a=document.createElement("div");
a.id="webSocketContainer";a.style.position="absolute";WebSocket.__isFlashLite()?(a.style.left="0px",a.style.top="0px"):(a.style.left="-100px",a.style.top="-100px");var d=document.createElement("div");d.id="webSocketFlash";a.appendChild(d);document.body.appendChild(a);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(a){a.success||i.error("[WebSocket] swfobject.embedSWF failed")})}else i.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")}},
WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var a=WebSocket.__flash.receiveEvents(),d=0;d<a.length;++d)WebSocket.__instances[a[d].webSocketId].__handleEvent(a[d])}catch(y){i.error(y)}},
0);return!0},WebSocket.__log=function(a){i.log(decodeURIComponent(a))},WebSocket.__error=function(a){i.error(decodeURIComponent(a))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!a||!a.enabledPlugin||!a.enabledPlugin.filename)return!1;return a.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||
(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()})))}})();
